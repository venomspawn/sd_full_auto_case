# Формат запросов к адаптеру СМЭВ 3

При вызове функции `on_case_creation` модуля бизнес-логики происходит
публикация сообщения STOMP с данными межведомственного запроса. Для этого
последовательно выполняются следующие действия.

1.  Создаётся UUID, который будет служить идентификатором сообщения и связывать
    ответ на межведомственный запрос с записью заявки.

2.  Создаётся запись межведомственного запроса, которая привязывается к записи
    заявки. К записи запроса прикрепляется атрибут `message_id` со значением,
    равным UUID, который создан на этапе 1.

3.  Создаётся ассоциативный массив вида

    ```ruby
    {
      id: <message_id>,
      content: {
        special_data: <case_special_data>,
        service_id:   <case_service_id>
      }
    }
    ```
    где `<message_id>` — это строка с UUID, который создан на этапе 1,
    `<case_special_data>` — это значение атрибута `special_data` заявки, а
    `<case_service_id>` — это значение атрибута `service_id` заявки.

4.  В очередь `smev3.queue` публикуется сообщение STOMP без заголовков и с
    телом, которое представляет собой JSON-представление ассоциативного
    массива, созданного на этапе 3.
